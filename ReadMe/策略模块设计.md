# 策略模块设计

## 模块路径
stockStrategy 

## 需求
实现不同的策略算法，判断股票买入卖出机制。使用策略模式，实现不同的处理、买卖策略

## 策略枚举 (Strategy Mode)

```go
const (
    // 追涨杀跌1 - 达到设定的时间（默认300天）内最高值时买入
    Strategy_Mode_1 = 1
    
    // 追涨杀跌2 - Breakout Trading 突破最近最高值，上升区间内买入
    Strategy_Mode_2 = 2
    
    // 波动 - Swing Trading 定位较为规律波动，且长期低位买入
    Strategy_Mode_3 = 3
    
    // 根据大盘 - 大盘局面好的时候买入
    Strategy_Mode_4 = 4
    
    // 拔尖 - 出现现象上涨时，突破行业顶峰时
    Strategy_Mode_5 = 5
    
    //行业/板块
    Strategy_Mode_6 = 6
)
```

## 核心实现

### 包声明

```go
package stockStrategy

import (
    "fmt"
    "stock/stockData"
)
```

### 数据结构定义

```go
// OperateRecord 操作记录
type OperateRecord struct {
    StockCode    string
    StockName    string
    StockNum     float64
    BuyOperate   Operate
    SellOperate  Operate
    Status       int     // 1-已买入 2-已卖出
    Profit       float64 // 收益
    OperateDate  string
    OperateTime  string
}

// Operate 单次操作
type Operate struct {
    OperateType int     // 1-买入 2-卖出
    BuyPrice    float64
    SellPrice   float64
    OperateDate string
    OperateTime string
    StockCode   string
    StockName   string
    StockNum    int
}

// Wallet 钱包状态
type Wallet struct {
    Status      int     // 1-持仓 2-空仓
    BuyPrice    float32 // 买入价格
    BuyDate     string  // 买入日期
    BuyIndex    int     // 买入的数据索引
}
```

### 策略接口定义

```go
type Strategy struct {
    config map[string]interface{} // 策略配置参数
}

type StockStrategy interface {
    //执行策略，通过GetstockBycode内部获取数据
    DealStrategy(code string) (operates map[string]OperateRecord)

    //判断是否符合买入条件
    //只传入当前价格，防止访问未来数据
    DealStrategyBuy(price float32, dateIndex int) (buy bool)

    //判断是否符合卖出条件
    //只传入当前价格，防止访问未来数据
    DealStrategySell(price float32, dataIndex int, wallet *Wallet) (sell bool)
}
```

## 策略1实现：追涨杀跌1 

达到设定的时间（默认300天）内最高值时买入

### 核心结构

```go
// BuyHighSellLowStrategy 追涨杀跌策略1
type BuyHighSellLowStrategy struct {
    LookbackDays    int       // 回看天数，默认300
    SellDropPercent float64   // 止损跌幅百分比，默认0.06（6%）
    MaxHoldDays     int       // 最大持有天数，默认15
    historyPrices   []float32 // 历史价格队列（内部维护，防止访问未来数据）
}
```

### 核心方法

```go
// DealStrategy 执行策略
func (strategy *BuyHighSellLowStrategy) DealStrategy(code string) map[string]OperateRecord {
    // 1. 获取股票数据
    // 2. 重置历史价格队列
    // 3. 初始化钱包状态为空仓
    // 4. 遍历所有数据，模拟实时接收价格
    //    - 将当前价格加入历史队列
    //    - 空仓时判断是否买入
    //    - 持仓时判断是否卖出
}

// DealStrategyBuy 判断是否符合买入条件
func (strategy *BuyHighSellLowStrategy) DealStrategyBuy(price float32, dateIndex int) bool {
    // 1. 检查历史数据是否充足
    // 2. 计算回看窗口内的最高价格
    // 3. 判断当前价格是否创新高（允许0.5%误差）
}

// DealStrategySell 判断是否符合卖出条件
func (strategy *BuyHighSellLowStrategy) DealStrategySell(price float32, dataIndex int, wallet *Wallet) bool {
    // 卖出条件（满足任一）：
    // 1. 止损：距离买入价下跌超过SellDropPercent
    // 2. 止盈：持有时间达到MaxHoldDays
}
```

### 实现文件

完整实现见：`stockStrategy/buyHighSellLowStrategy.go`


### 使用示例

```go
// 创建策略实例
strategy := stockStrategy.NewBuyHighSellLowStrategy()

// 或使用自定义参数
strategy := stockStrategy.NewBuyHighSellLowStrategyWithConfig(250, 0.08, 20)

// 执行策略
operates := strategy.DealStrategy("000001")

// 处理交易记录
for key, record := range operates {
    // 处理买卖记录
}
```

### 策略逻辑

#### 买入条件
当前价格达到或超过过去 `LookbackDays` 天内的最高价时买入（允许0.5%误差）

#### 卖出条件（满足任一）
1. **止损**: 跌幅超过 `SellDropPercent`
2. **止盈**: 持有时间达到 `MaxHoldDays`

## 设计要点

### 防止未来函数
- Buy/Sell 方法只接收当前价格参数
- 内部维护 `historyPrices` 队列，模拟实时接收数据
- 按时间顺序遍历，无法访问未来数据
- 确保回测结果可靠性

### 优化方向
1. 增加成交量过滤条件
2. 增加趋势判断（均线系统）
3. 支持动态参数调整
4. 增加止盈条件
5. 支持分批买卖
