# Stock-Go

一个用Go语言编写的股票数据分析和可视化工具。

## 项目简介

Stock-Go是一个专业的股票数据分析和可视化系统，旨在为股票投资者和分析师提供强大的技术分析工具。系统采用模块化设计，集成了多种数据处理、图表绘制和策略分析功能。

### 核心特性

- 📊 **多维度数据处理** - 支持股票日线数据加载、处理和分析
- 📈 **专业图表可视化** - 提供K线图、趋势线等多种图表类型
- 🧠 **智能策略分析** - 内置高点策略算法和循环峰值检测
- 🌐 **RESTful API服务** - 提供HTTP接口支持Web应用集成
- 🔔 **消息推送功能** - 支持微信推送重要分析结果
- 🎯 **高性能计算** - 基于Go语言并发特性实现高效数据处理

## 功能特性

### 📊 数据处理引擎
- **CSV数据加载** - 支持标准股票数据格式导入
- **高低点识别** - 智能识别股票价格的关键拐点
- **价格趋势分析** - 基于移动平均线和技术指标的趋势判断
- **数据分段处理** - 支持按时间窗口进行数据分析
- **实时数据监控** - 支持动态数据更新和监控

### 📈 可视化图表
- **K线图绘制** - 专业的蜡烛图表现股价走势
- **趋势线分析** - 支持支撑位和阻力位标记
- **高低点标记** - 自动标识关键价格节点
- **交互式图表** - 支持缩放、平移等交互操作
- **多格式输出** - 支持HTML、PNG等多种输出格式

### 🤖 策略分析系统
- **高点策略算法** - 基于历史高点的交易策略分析
- **循环峰值检测** - 按天循环查找价格峰值
- **时间窗口分析** - 支持自定义分析时间范围
- **风险控制机制** - 内置止损和风险评估功能

### 🌐 Web服务架构
- **RESTful API** - 标准HTTP接口设计
- **并发处理** - 支持多客户端同时访问
- **数据查询接口** - 提供灵活的数据检索功能
- **实时数据服务** - 支持WebSocket实时数据推送

## 架构设计

### 系统架构图

```
┌─────────────────────────────────────────────────────────┐
│                    Stock-Go 系统架构                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   HTTP      │    │   数据处理   │    │   策略分析   │  │
│  │   服务层     │◄──►│    引擎     │◄──►│    系统     │  │
│  └─────────────┘    └─────────────┘    └─────────────┘  │
│         │                   │                   │       │
│         ▼                   ▼                   ▼       │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   日志      │    │   数据存储   │    │   可视化     │  │
│  │   系统      │    │    层       │    │   渲染器     │  │
│  └─────────────┘    └─────────────┘    └─────────────┘  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 核心模块

#### 🔧 globalConfig
全局配置管理模块，负责系统参数配置和跨平台路径管理：
- **配置常量**：STOCK_SESSION_LEN(500), STOCK_SESSION_HIGHTPOINT_LEN(15)
- **跨平台支持**：自动识别Linux/macOS/Windows系统
- **路径管理**：智能配置数据和日志路径

#### 📊 stockData
股票数据处理核心模块：
- **数据结构**：StockInfo, StockDataDay 等核心数据类型
- **数据加载**：支持CSV格式股票数据批量导入
- **数据处理**：高低点识别、趋势分析等算法实现
- **内存管理**：高效的数据缓存和索引机制

#### 📈 painter
专业图表渲染模块：
- **多引擎支持**：集成go-echarts、go-chart、gnuplot等多个图表库
- **K线图**：专业的蜡烛图实现，支持成交量显示
- **趋势分析**：支撑位、阻力位自动标记
- **交互功能**：缩放、平移、数据点提示等

#### 🧠 stockStrategy
智能策略分析模块：
- **高点策略**：基于历史高点的交易信号生成
- **循环检测**：HighPointStrategyDayByDay 实现滑动窗口峰值检测
- **算法优化**：使用单调递减队列提升计算效率
- **风险控制**：内置多重安全检查机制

#### 🌐 http
Web服务模块：
- **RESTful API**：标准HTTP接口设计
- **路由管理**：/stock, /readDayDate 等核心接口
- **并发处理**：基于Go原生http包的高性能实现
- **错误处理**：完善的异常捕获和响应机制

#### 📝 logger
日志管理模块：
- **分级日志**：支持Info、Warn、Error等多个级别
- **文件输出**：自动日志文件轮转和管理
- **性能优化**：异步日志写入，避免I/O阻塞
- **格式化**：结构化日志输出，便于分析和监控

#### 🛠 utils
工具库模块：
- **通用工具**：常用算法和数据处理函数
- **微信集成**：消息推送和通知功能
- **辅助函数**：系统级操作和文件处理

## 项目结构

```
stock-go/
├── Data/                    # 数据文件目录
│   ├── getAllStockDatas.py  # 获取所有股票数据脚本
│   ├── updateDayDatas.py    # 更新日数据脚本
│   └── stockList.csv        # 股票列表
├── globalConfig/            # 全局配置
│   └── globalConfig.go
├── http/                    # HTTP服务
│   ├── server.go           # HTTP服务器
│   ├── stockHandler.go     # 股票处理器
│   └── readDayDate.go      # 读取日期数据
├── logger/                  # 日志模块
│   └── logger.go
├── painter/                 # 绘图模块
│   └── line.go             # 线性图绘制
├── stockData/              # 股票数据处理
│   ├── stockData.go        # 股票数据结构
│   ├── loadData.go         # 数据加载
│   ├── dealStockData.go    # 数据处理
│   └── defindStock.go      # 股票定义
├── stockStrategy/          # 策略模块
│   └── hightPointStrategy.go # 高点策略
├── utils/                  # 工具模块
│   ├── utils.go           # 通用工具
│   └── wechat.go          # 微信功能
├── go.mod                  # Go模块文件
├── go.sum                  # 依赖校验文件
└── stockServer.go          # 主程序入口
```

## 技术栈

### 核心技术
- **编程语言**: Go 1.22.9 - 高性能并发编程语言
- **模块管理**: Go Modules - 现代化依赖管理

### 图表可视化库
- **go-echarts/v2** `v2.2.4` - 交互式Web图表库
- **go-chart/v2** `v2.1.0` - 静态图表生成库  
- **go-gnuplot** - GNU Plot接口，专业科学绘图
- **gonum.org/v1/plot** `v0.14.0` - 科学计算图表库
- **vicanso/go-charts/v2** `v2.6.10` - 轻量级图表库
- **Arafatk/glot** - 在线图表渲染服务

### 系统依赖
- **标准库 net/http** - 原生HTTP服务器
- **标准库 runtime** - 跨平台系统检测
- **标准库 os/signal** - 优雅关闭处理

### 开发工具
- **测试框架**: Go内置testing包
- **包管理**: vendor目录管理第三方依赖
- **构建工具**: Go原生build工具链

### 数据处理
- **数据格式**: CSV文件存储，支持标准股票数据格式
- **算法优化**: 单调递减队列实现O(n)时间复杂度的滑动窗口最值查找
- **内存管理**: 高效的数据结构设计，支持大规模股票数据处理

## 快速开始

### 环境要求

- **Go版本**: 1.22.9 或更高版本
- **操作系统**: Linux/macOS/Windows (已适配)
- **内存**: 推荐 4GB+ RAM (用于大规模数据处理)
- **存储**: 数据目录需要足够空间存储股票历史数据

### 安装部署

#### 1. 获取源码
```bash
git clone <repository-url>
cd stock-go
```

#### 2. 环境配置
根据系统自动配置数据路径：
- **Linux**: `../Data/`, `../Log/`
- **macOS**: `/Users/beven/Item/stockData/`, `/Users/beven/Item/stock-go/Log/`
- **Windows**: `D:\Data\`, `D:\Log\`

#### 3. 依赖安装
```bash
# 下载Go模块依赖
go mod download

# 构建vendor目录（可选）
go mod vendor
```

#### 4. 编译构建
```bash
# 构建可执行文件
go build -o stockServer .

# 或者直接运行
go run stockServer.go
```

#### 5. 启动服务
```bash
# 运行编译后的程序
./stockServer

# 设置配置文件路径（可选）
export CONF_PROVIDER_FILE_PATH="conf/server.yml"
./stockServer
```

### 使用指南

#### 系统启动流程
1. **初始化** - 加载全局配置和日志系统
2. **启动HTTP服务** - 监听8080端口提供API服务
3. **启动数据服务** - 初始化股票数据加载模块
4. **生成默认图表** - 自动为sz.000001生成K线图
5. **信号处理** - 监听系统信号实现优雅关闭

#### HTTP API接口

##### 获取股票信息
```bash
curl http://localhost:8080/stock
```

##### 读取日期数据
```bash
curl http://localhost:8080/readDayDate
```

#### 数据文件格式

将股票数据CSV文件放置在配置的Data目录下，文件应包含以下字段：
```csv
日期,开盘价,收盘价,最高价,最低价,成交量,成交额
2024-01-01,10.50,10.80,10.90,10.40,1000000,1080000000
```

#### 策略分析使用

系统内置两种高点策略：

1. **基础高点策略** (`HighPointStrategy`)
   - 分析最近500天内的高点
   - 筛选15天内的关键高点
   - 自动生成K线图和分析报告

2. **循环峰值检测** (`HighPointStrategyDayByDay`)
   - 使用滑动窗口算法
   - 逐日检测价格峰值
   - 高效的O(n)时间复杂度

## 配置说明

### 系统配置参数

核心配置位于 `globalConfig/globalConfig.go`:

```go
// 股票分析会话长度（天数）
STOCK_SESSION_LEN = 500

// 高点策略时间窗口（天数）  
STOCK_SESSION_HIGHTPOINT_LEN = 15

// 数据加载参数
STOCK_DATA_LOAD_PCT = 500
STOCK_DATA_LOAD_MOD = 0
```

### 路径配置

系统根据操作系统自动配置路径：

#### Linux环境
```go
DATA_PATH = "../Data/"
LOG_PATH = "../Log/"
```

#### macOS环境  
```go
DATA_PATH = "/Users/beven/Item/stockData/"
LOG_PATH = "/Users/beven/Item/stock-go/Log/"
```

#### Windows环境
```go
DATA_PATH = "D:\\Data\\"
LOG_PATH = "D:\\Log\\"
```

### 环境变量

支持以下环境变量配置：

```bash
# 配置文件路径
export CONF_PROVIDER_FILE_PATH="conf/server.yml"

# 日志级别
export LOG_LEVEL="INFO"

# HTTP服务端口（默认8080）
export SERVER_PORT="8080"
```

## 开发指南

### 代码结构设计

#### 模块化架构
- **职责分离**: 每个包负责特定功能领域
- **接口设计**: 定义清晰的模块间接口
- **依赖管理**: 避免循环依赖，保持单向依赖关系

#### 并发处理
- **Goroutine**: HTTP服务和数据处理并发执行
- **Channel**: 安全的数据传递和同步
- **信号处理**: 优雅关闭机制

#### 错误处理
- **分层错误处理**: 各层级都有完善的错误处理
- **日志记录**: 详细的错误日志和调试信息
- **恢复机制**: 系统异常自动恢复

### 代码规范

#### 命名约定
- **包名**: 小写，简洁明了
- **函数名**: 驼峰命名，公开函数首字母大写
- **变量名**: 驼峰命名，见名知意
- **常量**: 全大写，下划线分隔

#### 注释规范
- **包注释**: 每个包都有详细的功能说明
- **函数注释**: 公开函数必须有注释说明
- **算法注释**: 复杂算法有详细的实现说明

### 测试策略

#### 单元测试
系统包含多个测试文件：
- `data_test.go` - 数据处理模块测试
- `server_test.go` - HTTP服务测试  
- `chart_test.go` - 图表渲染测试
- `hightPointStrategy_test.go` - 策略算法测试

#### 测试运行
```bash
# 运行所有测试
go test ./...

# 运行特定模块测试
go test ./stockData
go test ./stockStrategy

# 生成测试覆盖率报告
go test -cover ./...
```

### 性能优化

#### 算法优化
- **滑动窗口最值**: 使用单调递减队列，时间复杂度O(n)
- **数据缓存**: 智能缓存热点数据，减少I/O操作
- **并发处理**: 充分利用多核CPU进行并行计算

#### 内存管理
- **数据结构**: 选择合适的数据结构减少内存占用
- **垃圾回收**: 避免频繁的对象创建和销毁
- **内存池**: 对于高频操作使用对象池模式

### 扩展开发

#### 添加新策略
在 `stockStrategy` 包中添加新的策略算法：

```go
func NewStrategy(stockCode string) {
    // 实现新的分析策略
}
```

#### 添加新图表类型
在 `painter` 包中扩展图表功能：

```go
func PaintNewChartType(stockCode string) {
    // 实现新的图表类型
}
```

#### 添加新数据源
在 `stockData` 包中添加数据源支持：

```go
func LoadFromNewSource(source string) {
    // 实现新数据源加载
}
```

## 问题排查

### 常见问题

#### 1. 编译错误
```bash
# 确保Go版本正确
go version

# 清理模块缓存
go clean -modcache
go mod download
```

#### 2. 端口占用
```bash
# 检查8080端口占用
lsof -i :8080

# 修改端口（在代码中）
# http/server.go:16 修改端口号
```

#### 3. 数据文件路径问题
```bash
# 确认数据目录存在
ls -la ../Data/

# 检查文件权限
chmod 755 ../Data/
```

#### 4. 图表生成失败
```bash
# 检查依赖库是否正确安装
go mod verify

# 确认输出目录权限
mkdir -p ./output
chmod 755 ./output
```

### 日志分析

系统日志位于配置的LOG_PATH目录：
- **INFO级别**: 正常操作日志
- **WARN级别**: 警告信息  
- **ERROR级别**: 错误信息

```bash
# 查看最新日志
tail -f ../Log/stock-go.log

# 过滤错误日志
grep "ERROR" ../Log/stock-go.log
```

## 贡献指南

### 开发流程

1. **Fork项目** - 从主仓库创建分支
2. **创建功能分支** - 基于master创建feature分支
3. **开发测试** - 编写代码并添加测试用例
4. **提交代码** - 遵循提交信息规范
5. **发起PR** - 提供详细的变更说明

### 提交规范

```bash
# 功能增加
git commit -m "feat: 添加新的股票指标计算功能"

# 问题修复  
git commit -m "fix: 修复K线图渲染内存泄漏问题"

# 文档更新
git commit -m "docs: 更新API文档和使用说明"

# 性能优化
git commit -m "perf: 优化数据加载性能"
```

### 代码审查

- **代码风格**: 遵循Go官方代码规范
- **测试覆盖**: 新功能必须包含单元测试
- **文档更新**: 重大变更需要更新相关文档
- **性能测试**: 性能相关修改需要基准测试

## 版本历史

### 最近更新
- ✅ **[功能新增]** 添加按天循环查找峰值功能
- ✅ **[功能新增]** 添加plot绘图支持  
- ✅ **[功能修改]** 修改macOS下路径配置
- ✅ **[功能新增]** 添加高点分析策略
- ✅ **[功能修改]** 优化日志系统性能
- ✅ **[功能修改]** 去除dubbo-go依赖，简化架构

### 版本规划
- 🔄 **v1.1.0** - 支持实时数据接入
- 🔄 **v1.2.0** - 添加更多技术指标
- 🔄 **v1.3.0** - Web界面管理后台
- 🔄 **v2.0.0** - 分布式架构支持

## 许可证

本项目采用 **MIT许可证** 开源，详情请查看 [LICENSE](LICENSE) 文件。

### 许可证要点
- ✅ 商业使用
- ✅ 修改和分发  
- ✅ 私人使用
- ❗ 需要包含许可证和版权声明
- ❗ 软件按"原样"提供，不提供任何担保

## 免责声明

**重要提醒**: 本项目为股票数据分析工具，仅供学习和研究使用。

⚠️ **风险提示**:
- 本工具提供的分析结果不构成任何投资建议
- 股票投资有风险，入市需谨慎
- 用户应该根据自己的风险承受能力做出投资决策
- 开发者不对使用本工具造成的任何投资损失负责

📧 **联系方式**: 如有问题或建议，请通过Issue或Pull Request与我们联系。

---

<div align="center">

**Stock-Go** - 专业的Go语言股票分析工具

[⭐ Star](../../stargazers) | [🐛 报告问题](../../issues) | [💡 功能建议](../../issues/new)

Made with ❤️ by Stock-Go Team

</div>